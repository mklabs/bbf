(function(a,b,c){var d=b.template(["<% _.each(items, function(item) { %>",' <div class="clearfix">','   <label for="input-<%= item.cid %>-<%= item.label %>"><%= item.label %></label>','   <div class="input">',"     <%= item.html %>","   </div>"," </div>","<% }); %>"].join("\n")),e=/\r?\n/g,f=/^(?:select|textarea)/i,g=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,h=a.Form=a.View.extend({tagName:"form",exclude:[],options:{template:d},initialize:function(){if(!this.model)throw new Error("Backbone.Form needs a model to work with.");if(!(this.model instanceof a.Model))throw new Error("'Backbone.Form's model should be a Backbone.Model instance")},html:function(c,d){c=c||this.model.attributes,d=d?d+"-":"";var e=this,f=b.keys(c),g=[];return b.each(f,function(a,f){var h=c[a],i=e.getType(h),j=!!~b.indexOf(e.exclude,a);if(j)return;g.push({type:i,html:e.getHtml(a,h,i,d),label:a,value:h,cid:e.cid})}),this.options.template({items:g})},getType:function(c){if(typeof c=="string")return"text";if(typeof c=="number")return"text";if(b.isArray(c))return"select";if(typeof c=="object")return"object";if(typeof c=="boolean")return"checkbox"},getHtml:function(b,c,d,e){var f,g=this.mapping||{},h=g[b]&&this.model.get(g[b]);b=e+b;if(d==="text")return'<input class="xlarge" id="input-:cid-:label" name="input-:cid-:label" size="30" type="text" value=":value" />'.replace(/:cid/g,this.cid).replace(/:label/g,b).replace(/:value/g,c);if(d==="select"){if(!Array.isArray(c))throw new Error("values should be an array with select type");return f=['<select id="input-:cid-:label" name="input-:cid-:label" class="xlarge">'],f=f.concat(c.map(function(a){return'<option value="'+a+'"'+(h&&h===a?'selected="selected"':"")+">"+a+"</option>"})),f.push("</select>"),f.join("\n").replace(/:cid/g,this.cid).replace(/:label/g,b).replace(/:value/g,c)}if(d==="checkbox")return f=['<div class="input-prepend">','  <label class="add-on activ">','    <input type="checkbox" class="xlarge" name="input-:cid-:label" id="input-:cid-:label" '+(c?'checked="checked"':"")+"/>","  </label>","</div>"],f.join("\n").replace(/:cid/g,this.cid).replace(/:label/g,b).replace(/:value/g,c);if(d==="object")return this.html(c,b);throw new Error("Unknown field type "+d)},render:function(){return $(this.el).html(this.html()),this},serialize:function(c){var d=this.tagName==="form"?$(this.el):$(this.el).find("form"),e=this,f=this.cid,g={},h;if(!d.length)throw new Error("Serialize must operate on a form element");return b.each(this.serializeArray(d),function(a,c){var d=a.name.replace("input-"+f+"-",""),h=d.split("-"),i=h.length,j=g;if(i===1)return g[d]=e.value(a.value);b.each(h,function(b,c){!j[b]&&c+1!==i?j=j[b]={}:j[b]&&c+1!==i?j=j[b]:j[b]||(j[b]=e.value(a.value))})}),g},serializeArray:function(b){return b.map(function(){return this.elements?jQuery.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked!=null||f.test(this.nodeName)||g.test(this.type))}).map(function(a,b){var c=jQuery(this).val();return c=c==="on"?this.checked+"":c,c==null?null:jQuery.isArray(c)?jQuery.map(c,function(a,c){return{name:b.name,value:a.replace(e,"\r\n")}}):{name:b.name,value:c.replace(e,"\r\n")}}).get()},value:function(b){return b==="true"?!0:b==="false"?!1:b==="null"?null:!isNaN(parseFloat(b))&&isFinite(b)?parseFloat(b):b}})})(this.Backbone,this._,this);